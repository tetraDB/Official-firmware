#pragma once

#include "tw_apps/tw_app.h"
#include "utilities/tiny3D.h"

class App3D : public tw_app
{
	public:
		void setup(void);
		void pre_start(void);
		void draw(bool force);
		void draw_icon(uint8_t canvasid, int16_t _pos_x, int16_t _pos_y, uint8_t style_hint);
		bool process_touch(touch_event_t touch_event);

	private:
		float display_center_x = display.width / 2;
		float display_center_y = display.height / 2;
		void draw3D();

		float rotation[3]
		{ 
			0,
			0,
			180
		};

		Vector3D rotated_square[8];
		Vector3D rotated_arrow[4];


		#define verticies 144u
		#define polygons 284u
		float palne_scale = 120.0;

		uint16_t polygon_colors[5]
		{
			TFT_RED,
			TFT_GREEN,
			TFT_BLUE,
			TFT_BLACK,
			TFT_WHITE
		};

		RotationMatrix rotation_matrix;
		Vector3D xyz_cube_verticies_rotated[verticies];
		Vector3D xyz_cube_verticies[verticies] = {
			Vector3D {-25.0,-25.0,25.0},
Vector3D {-25.0,25.0,-25.0},
Vector3D {-25.0,25.0,25.0},
Vector3D {25.0,25.0,-25.0},
Vector3D {25.0,25.0,25.0},
Vector3D {-25.0,-25.0,-25.0},
Vector3D {25.0,-25.0,-25.0},
Vector3D {25.0,-25.0,25.0},
Vector3D {5.0,-25.0,-15.0},
Vector3D {-5.0,-25.0,-15.0},
Vector3D {5.0,-25.0,-5.0},
Vector3D {-5.0,-25.0,-5.0},
Vector3D {15.0,-25.0,5.0},
Vector3D {5.0,-25.0,5.0},
Vector3D {-5.0,-25.0,5.0},
Vector3D {-15.0,-25.0,5.0},
Vector3D {15.0,-25.0,15.0},
Vector3D {5.0,-25.0,15.0},
Vector3D {-5.0,-25.0,15.0},
Vector3D {-15.0,-25.0,15.0},
Vector3D {-5.0,25.0,-15.0},
Vector3D {5.0,25.0,-14.9},
Vector3D {-5.0,25.0,-5.0},
Vector3D {5.0,25.0,-5.0},
Vector3D {-15.0,25.0,5.0},
Vector3D {-5.0,25.0,5.0},
Vector3D {5.0,25.0,5.0},
Vector3D {15.0,25.0,5.0},
Vector3D {-15.0,25.0,15.0},
Vector3D {-5.0,25.0,15.0},
Vector3D {5.0,25.0,15.0},
Vector3D {15.0,25.0,15.0},
Vector3D {25.0,14.4,-7.2},
Vector3D {25.0,0.0,-7.2},
Vector3D {25.0,-14.4,-7.2},
Vector3D {25.0,14.4,7.2},
Vector3D {25.0,0.0,7.2},
Vector3D {25.0,-14.4,7.2},
Vector3D {25.0,7.2,-14.4},
Vector3D {25.0,-7.2,-14.4},
Vector3D {25.0,7.2,0.0},
Vector3D {25.0,-7.2,0.0},
Vector3D {25.0,7.2,14.4},
Vector3D {25.0,-7.2,14.4},
Vector3D {-25.0,-14.4,-7.2},
Vector3D {-25.0,0.0,-7.2},
Vector3D {-25.0,14.4,-7.2},
Vector3D {-25.0,-14.4,7.2},
Vector3D {-25.0,0.0,7.2},
Vector3D {-25.0,14.4,7.2},
Vector3D {-25.0,-7.2,-14.4},
Vector3D {-25.0,7.2,-14.4},
Vector3D {-25.0,-7.2,0.0},
Vector3D {-25.0,7.2,0.0},
Vector3D {-25.0,-7.2,14.4},
Vector3D {-25.0,7.2,14.4},
Vector3D {12.1,15.0,25.0},
Vector3D {12.1,5.0,25.0},
Vector3D {12.1,-5.0,25.0},
Vector3D {12.1,-15.0,25.0},
Vector3D {0.0,5.0,25.0},
Vector3D {0.0,-5.0,25.0},
Vector3D {-12.1,15.0,25.0},
Vector3D {-12.1,5.0,25.0},
Vector3D {-12.1,-5.0,25.0},
Vector3D {-12.1,-15.0,25.0},
Vector3D {-12.1,15.0,-25.0},
Vector3D {-12.1,5.0,-25.0},
Vector3D {-12.1,-5.0,-25.0},
Vector3D {-12.1,-15.0,-25.0},
Vector3D {12.1,15.0,-25.0},
Vector3D {12.1,5.0,-25.0},
Vector3D {12.1,-5.0,-25.0},
Vector3D {12.1,-15.0,-25.0},
Vector3D {12.1,15.0,20.0},
Vector3D {12.1,5.0,20.0},
Vector3D {12.1,-5.0,20.0},
Vector3D {12.1,-15.0,20.0},
Vector3D {0.0,5.0,20.0},
Vector3D {0.0,-5.0,20.0},
Vector3D {-12.1,15.0,20.0},
Vector3D {-12.1,5.0,20.0},
Vector3D {-12.1,-5.0,20.0},
Vector3D {-12.1,-15.0,20.0},
Vector3D {5.0,-20.0,-15.0},
Vector3D {-5.0,-20.0,-15.0},
Vector3D {5.0,-20.0,-5.0},
Vector3D {-5.0,-20.0,-5.0},
Vector3D {15.0,-20.0,5.0},
Vector3D {5.0,-20.0,5.0},
Vector3D {-5.0,-20.0,5.0},
Vector3D {-15.0,-20.0,5.0},
Vector3D {15.0,-20.0,15.0},
Vector3D {5.0,-20.0,15.0},
Vector3D {-5.0,-20.0,15.0},
Vector3D {-15.0,-20.0,15.0},
Vector3D {-5.0,20.0,-15.0},
Vector3D {5.0,20.0,-15.0},
Vector3D {-5.0,20.0,-5.0},
Vector3D {5.0,20.0,-4.92},
Vector3D {-15.0,20.0,5.0},
Vector3D {-5.0,20.0,5.0},
Vector3D {5.0,20.0,5.0},
Vector3D {15.0,20.0,5.0},
Vector3D {-15.0,20.0,15.0},
Vector3D {-5.0,20.0,15.0},
Vector3D {5.0,20.0,15.0},
Vector3D {15.0,20.0,15.0},
Vector3D {20.0,14.4,-7.2},
Vector3D {20.0,0.0,-7.2},
Vector3D {20.0,-14.4,-7.2},
Vector3D {20.0,14.4,7.2},
Vector3D {20.0,0.0,7.2},
Vector3D {20.0,-14.4,7.2},
Vector3D {20.0,7.2,-14.4},
Vector3D {20.0,-7.2,-14.4},
Vector3D {20.0,7.2,0.0},
Vector3D {20.0,-7.2,0.0},
Vector3D {20.0,7.2,14.4},
Vector3D {20.0,-7.2,14.4},
Vector3D {-20.0,-14.4,-7.2},
Vector3D {-20.0,0.0,-7.2},
Vector3D {-20.0,14.4,-7.2},
Vector3D {-20.0,-14.4,7.2},
Vector3D {-20.0,0.0,7.2},
Vector3D {-20.0,14.4,7.2},
Vector3D {-20.0,-7.2,-14.4},
Vector3D {-20.0,7.2,-14.4},
Vector3D {-20.0,-7.2,0.0},
Vector3D {-20.0,7.2,0.0},
Vector3D {-20.0,-7.2,14.4},
Vector3D {-20.0,7.2,14.4},
Vector3D {1.91e-07,5.0,-25.0},
Vector3D {1.91e-07,-5.0,-25.0},
Vector3D {12.1,15.0,-20.0},
Vector3D {12.1,5.0,-20.0},
Vector3D {12.1,-5.0,-20.0},
Vector3D {12.1,-15.0,-20.0},
Vector3D {1.91e-07,5.0,-20.0},
Vector3D {1.91e-07,-5.0,-20.0},
Vector3D {-12.1,15.0,-20.0},
Vector3D {-12.1,5.0,-20.0},
Vector3D {-12.1,-5.0,-20.0},
Vector3D {-12.1,-15.0,-20.0}
		};
		Polygon xyz_cube_polygons[polygons] = {
			Polygon {63,64,60,2},
Polygon {21,3,1,1},
Polygon {5,44,50,0},
Polygon {6,10,8,1},
Polygon {30,26,25,1},
Polygon {3,32,38,0},
Polygon {51,50,45,0},
Polygon {54,55,48,0},
Polygon {7,37,43,0},
Polygon {2,62,56,2},
Polygon {58,57,61,2},
Polygon {7,59,65,2},
Polygon {3,70,66,2},
Polygon {73,6,5,2},
Polygon {44,47,52,0},
Polygon {46,53,49,0},
Polygon {32,3,4,0},
Polygon {37,34,41,0},
Polygon {15,19,0,1},
Polygon {17,16,7,1},
Polygon {9,5,6,1},
Polygon {23,3,21,1},
Polygon {2,28,24,1},
Polygon {2,49,55,0},
Polygon {47,0,54,0},
Polygon {2,55,54,0},
Polygon {46,1,51,0},
Polygon {5,50,51,0},
Polygon {42,43,36,0},
Polygon {35,4,42,0},
Polygon {39,38,33,0},
Polygon {34,6,39,0},
Polygon {7,43,42,0},
Polygon {6,34,37,0},
Polygon {40,32,35,0},
Polygon {3,38,39,0},
Polygon {13,17,18,1},
Polygon {4,31,30,1},
Polygon {7,16,12,1},
Polygon {9,11,5,1},
Polygon {3,23,27,1},
Polygon {20,1,22,1},
Polygon {1,2,24,1},
Polygon {31,4,27,1},
Polygon {4,3,27,1},
Polygon {22,1,24,1},
Polygon {0,65,64,2},
Polygon {7,58,59,2},
Polygon {15,0,5,1},
Polygon {6,7,12,1},
Polygon {11,15,5,1},
Polygon {10,6,12,1},
Polygon {19,18,0,1},
Polygon {17,7,0,1},
Polygon {14,13,18,1},
Polygon {29,30,25,1},
Polygon {4,30,29,1},
Polygon {28,2,29,1},
Polygon {1,46,49,0},
Polygon {0,47,44,0},
Polygon {4,56,57,2},
Polygon {0,64,63,2},
Polygon {62,2,63,2},
Polygon {4,57,58,2},
Polygon {71,70,3,2},
Polygon {67,1,66,2},
Polygon {1,67,68,2},
Polygon {69,5,68,2},
Polygon {73,72,6,2},
Polygon {71,3,6,2},
Polygon {4,7,42,0},
Polygon {6,3,39,0},
Polygon {8,9,6,1},
Polygon {18,17,0,1},
Polygon {0,2,54,0},
Polygon {1,5,51,0},
Polygon {2,1,49,0},
Polygon {5,0,44,0},
Polygon {2,4,29,1},
Polygon {20,21,1,1},
Polygon {35,32,4,0},
Polygon {7,6,37,0},
Polygon {2,0,63,2},
Polygon {7,4,58,2},
Polygon {4,2,56,2},
Polygon {0,7,65,2},
Polygon {72,71,6,2},
Polygon {5,1,68,2},
Polygon {1,3,66,2},
Polygon {69,73,5,2},
Polygon {64,82,78,3},
Polygon {59,77,83,3},
Polygon {62,80,74,3},
Polygon {58,76,77,3},
Polygon {57,75,79,3},
Polygon {56,74,75,3},
Polygon {61,79,76,3},
Polygon {65,83,82,3},
Polygon {60,78,81,3},
Polygon {63,81,80,3},
Polygon {80,81,78,4},
Polygon {11,87,91,3},
Polygon {8,84,85,3},
Polygon {10,86,84,3},
Polygon {17,93,92,3},
Polygon {18,94,90,3},
Polygon {9,85,87,3},
Polygon {19,95,94,3},
Polygon {15,91,95,3},
Polygon {16,92,88,3},
Polygon {12,88,86,3},
Polygon {14,90,89,3},
Polygon {13,89,93,3},
Polygon {90,94,95,4},
Polygon {28,104,100,3},
Polygon {26,102,101,3},
Polygon {24,100,98,3},
Polygon {25,101,105,3},
Polygon {20,96,97,3},
Polygon {22,98,96,3},
Polygon {23,99,103,3},
Polygon {29,105,104,3},
Polygon {30,106,102,3},
Polygon {21,97,99,3},
Polygon {31,107,106,3},
Polygon {27,103,107,3},
Polygon {102,106,107,4},
Polygon {35,111,116,3},
Polygon {32,108,114,3},
Polygon {33,109,115,3},
Polygon {37,113,119,3},
Polygon {41,117,113,3},
Polygon {34,110,117,3},
Polygon {38,114,109,3},
Polygon {42,118,111,3},
Polygon {43,119,112,3},
Polygon {40,116,108,3},
Polygon {39,115,110,3},
Polygon {36,112,118,3},
Polygon {112,116,111,4},
Polygon {55,131,124,3},
Polygon {44,120,126,3},
Polygon {49,125,131,3},
Polygon {53,129,125,3},
Polygon {48,124,130,3},
Polygon {47,123,128,3},
Polygon {54,130,123,3},
Polygon {50,126,121,3},
Polygon {51,127,122,3},
Polygon {52,128,120,3},
Polygon {46,122,129,3},
Polygon {45,121,127,3},
Polygon {120,121,126,4},
Polygon {79,77,76,4},
Polygon {79,78,82,4},
Polygon {59,58,77,3},
Polygon {75,78,79,4},
Polygon {74,80,78,4},
Polygon {79,82,83,4},
Polygon {77,79,83,4},
Polygon {75,74,78,4},
Polygon {113,117,112,4},
Polygon {109,114,108,4},
Polygon {110,115,109,4},
Polygon {117,109,116,4},
Polygon {119,113,112,4},
Polygon {118,112,111,4},
Polygon {116,109,108,4},
Polygon {117,110,109,4},
Polygon {112,117,116,4},
Polygon {124,123,130,4},
Polygon {131,125,124,4},
Polygon {128,123,124,4},
Polygon {122,127,121,4},
Polygon {128,121,120,4},
Polygon {125,129,124,4},
Polygon {129,128,124,4},
Polygon {129,122,121,4},
Polygon {128,129,121,4},
Polygon {96,98,99,4},
Polygon {104,105,101,4},
Polygon {98,101,102,4},
Polygon {98,100,101,4},
Polygon {99,102,103,4},
Polygon {103,102,107,4},
Polygon {100,104,101,4},
Polygon {99,98,102,4},
Polygon {97,96,99,4},
Polygon {89,86,88,4},
Polygon {86,89,90,4},
Polygon {84,86,87,4},
Polygon {87,90,91,4},
Polygon {89,88,92,4},
Polygon {93,89,92,4},
Polygon {91,90,95,4},
Polygon {87,86,90,4},
Polygon {85,84,87,4},
Polygon {56,62,74,3},
Polygon {57,56,75,3},
Polygon {61,57,79,3},
Polygon {58,61,76,3},
Polygon {65,59,83,3},
Polygon {64,65,82,3},
Polygon {60,64,78,3},
Polygon {63,60,81,3},
Polygon {62,63,80,3},
Polygon {30,31,106,3},
Polygon {26,30,102,3},
Polygon {25,26,101,3},
Polygon {29,25,105,3},
Polygon {28,29,104,3},
Polygon {24,28,100,3},
Polygon {22,24,98,3},
Polygon {20,22,96,3},
Polygon {21,20,97,3},
Polygon {23,21,99,3},
Polygon {27,23,103,3},
Polygon {31,27,107,3},
Polygon {43,37,119,3},
Polygon {36,43,112,3},
Polygon {42,36,118,3},
Polygon {35,42,111,3},
Polygon {40,35,116,3},
Polygon {32,40,108,3},
Polygon {38,32,114,3},
Polygon {33,38,109,3},
Polygon {39,33,115,3},
Polygon {34,39,110,3},
Polygon {41,34,117,3},
Polygon {37,41,113,3},
Polygon {18,19,94,3},
Polygon {14,18,90,3},
Polygon {13,14,89,3},
Polygon {17,13,93,3},
Polygon {16,17,92,3},
Polygon {12,16,88,3},
Polygon {10,12,86,3},
Polygon {8,10,84,3},
Polygon {9,8,85,3},
Polygon {11,9,87,3},
Polygon {15,11,91,3},
Polygon {19,15,95,3},
Polygon {48,55,124,3},
Polygon {54,48,130,3},
Polygon {47,54,123,3},
Polygon {52,47,128,3},
Polygon {44,52,120,3},
Polygon {50,44,126,3},
Polygon {45,50,121,3},
Polygon {51,45,127,3},
Polygon {46,51,122,3},
Polygon {53,46,129,3},
Polygon {49,53,125,3},
Polygon {55,49,131,3},
Polygon {68,67,133,2},
Polygon {72,132,71,2},
Polygon {132,136,138,3},
Polygon {66,134,140,3},
Polygon {70,135,134,3},
Polygon {69,142,143,3},
Polygon {68,139,142,3},
Polygon {133,141,139,3},
Polygon {67,140,141,3},
Polygon {72,137,136,3},
Polygon {73,143,137,3},
Polygon {71,138,135,3},
Polygon {139,143,142,4},
Polygon {138,139,141,4},
Polygon {140,138,141,4},
Polygon {138,136,139,4},
Polygon {139,137,143,4},
Polygon {136,137,139,4},
Polygon {135,138,134,4},
Polygon {134,138,140,4},
Polygon {70,134,66,3},
Polygon {71,135,70,3},
Polygon {132,138,71,3},
Polygon {72,136,132,3},
Polygon {73,137,72,3},
Polygon {69,143,73,3},
Polygon {68,142,69,3},
Polygon {133,139,68,3},
Polygon {67,141,133,3},
Polygon {66,140,67,3}
		};

};

extern App3D app_3D;
